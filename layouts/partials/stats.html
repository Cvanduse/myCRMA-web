{{ $stats := site.GetPage "sections/stats" }}
<section class="stats-section py-12 bg-off-white">
  <div class="container mx-auto px-4">
    <!-- Single Responsive Layout -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-8">
      <!-- Stats Row -->
      <div class="grid grid-cols-2 md:flex md:flex-row gap-6 md:gap-8 lg:gap-12 justify-center md:justify-start md:flex-1">
        {{ range $stats.Params.stats }}
          <div class="text-center stat-item">
            <div class="text-3xl md:text-4xl lg:text-5xl font-bold text-slate-blue countup" data-target="{{ .number }}">0</div>
            <div class="text-sm md:text-lg text-charcoal mt-2 leading-tight">{{ .label }}</div>
          </div>
        {{ end }}
      </div>
      <!-- Description -->
      <div class="text-center md:text-left md:flex-1 md:pl-8 lg:pl-12">
        <div class="desc-text text-base md:text-lg text-charcoal max-w-sm md:max-w-xl mx-auto md:mx-0" style="line-height:1.6">{{ $stats.Params.description | safeHTML }}</div>
      </div>
    </div>
  </div>
</section>
<script>
// Count up animation for stats - prevent duplicate runs
(function() {
  let hasRun = false;
  
  function animateCountUp(el, target) {
    // Skip if already animated
    if (el.dataset.animated === 'true') return;
    el.dataset.animated = 'true';
    
    let start = 0;
    let end = parseInt(target.replace(/[^\d]/g, ''));
    let isPercent = target.includes('%');
    let isPlus = target.includes('+');
    let duration = 1500;
    let startTime = null;
    
    function step(timestamp) {
      if (!startTime) startTime = timestamp;
      let progress = Math.min((timestamp - startTime) / duration, 1);
      let value = Math.floor(progress * (end - start) + start);
      el.textContent = value + (isPercent ? '%' : '') + (isPlus ? '+' : '');
      if (progress < 1) {
        requestAnimationFrame(step);
      } else {
        el.textContent = target;
      }
    }
    requestAnimationFrame(step);
  }
  
  function runCountUps() {
    if (hasRun) return;
    hasRun = true;
    
    // Only animate visible countup elements (respects responsive classes)
    document.querySelectorAll('.countup').forEach(function(el) {
      // Check if element is visible (not hidden by responsive classes)
      const style = window.getComputedStyle(el);
      if (style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0') {
        animateCountUp(el, el.getAttribute('data-target'));
      }
    });
  }
  
  // Check if section is already visible on load
  function checkInitialVisibility() {
    var statsSection = document.querySelector('.stats-section');
    if (statsSection) {
      const rect = statsSection.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom > 0) {
        runCountUps();
        return;
      }
    }
    
    // Otherwise, wait for scroll
    function onVisible(element, callback) {
      function checkVisibility() {
        const rect = element.getBoundingClientRect();
        if (rect.top < window.innerHeight && rect.bottom > 0) {
          callback();
          window.removeEventListener('scroll', checkVisibility);
          window.removeEventListener('resize', checkVisibility);
        }
      }
      window.addEventListener('scroll', checkVisibility);
      window.addEventListener('resize', checkVisibility);
      checkVisibility();
    }
    
    if (statsSection) {
      onVisible(statsSection, runCountUps);
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkInitialVisibility);
  } else {
    checkInitialVisibility();
  }
})();
</script> 